<!DOCTYPE html>
<html lang="en">
<!-- Authenticated chat interface for SyväAI conversations -->
  <script>
  // Apply dark mode class *before* page paints
  (function () {
    try {
      const isDark = localStorage.getItem('darkMode') === 'true';
      if (isDark) document.documentElement.classList.add('dark-mode');
    } catch (e) {}
  })();
</script>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SyväAI</title>
    <link rel="icon" href="/logos/logo/SyvaAI.png" type="image/png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<!-- Firebase v8 SDK bundles for chat authentication -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>


<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script> <!-- Firestore enables chat history storage -->
    <script type="module" src="index.js"></script>
</head>
<body>
  <!-- Runtime geoblocking logic for sanctioned regions -->
  <script>
// Blocked countries
const BLOCKED_COUNTRIES = ['CN', 'IR', 'KP', 'SY', 'CU', 'RU', 'BY', 'MM', 'VE', 'SD', 'AF', 'SL', 'UA', 'TR'];

// Check user's country on page load
async function checkGeoblock() {
  try {
    // Use free IP geolocation API
    const response = await fetch('https://ipapi.co/json/');
    const data = await response.json();
    
    const countryCode = data.country_code;
    
    console.log('User country:', countryCode);
    
    if (BLOCKED_COUNTRIES.includes(countryCode)) {
      // Block access
      document.body.innerHTML = `
        <div style="
          display: flex;
          justify-content: center;
          align-items: center;
          height: 100vh;
          background: #1a1a1a;
          color: white;
          font-family: Arial, sans-serif;
          text-align: center;
          padding: 20px;
        ">
          <div>
            <h1>Access Denied</h1>
            <p>Access to this service is not available in your region.</p>
            <p style="color: #888; font-size: 14px;">Country: ${countryCode}</p>
          </div>
        </div>
      `;
      
      // Prevent any further script execution
      throw new Error('Geoblocked');
    }
  } catch (error) {
    if (error.message === 'Geoblocked') {
      throw error;
    }
    // If geolocation fails, allow access (fail-open)
    console.log('Geolocation check failed, allowing access');
  }
}

// Run check immediately
checkGeoblock();
</script>
  <!-- Firebase initialization and authentication guard -->
  <script>
    const firebaseConfig = {
  apiKey: "AIzaSyD_qlUue2zbN98YbZEdiTAUoGfD9AQ1250",
  authDomain: "syvaai-website.firebaseapp.com",
  databaseURL: "https://syvaai-website-default-rtdb.firebaseio.com",
  projectId: "syvaai-website",
  storageBucket: "syvaai-website.appspot.com",
  messagingSenderId: "617237097658",
  appId: "1:617237097658:web:f037266cbbf5d82e80e683",
  measurementId: "G-CPMSS94CFR",
};
if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
} else {
  firebase.app(); // If already initialized
}
    document.addEventListener("DOMContentLoaded", function() {
   // Firebase authentication check when the page loads
   firebase.auth().onAuthStateChanged(user => {
      if (!user) {
         // If the user is not signed in, redirect them to the sign-in page
         window.location.href = "/chat/5667862vc72647237n67an769ndn793n6n9a76wr9wra.html"; // Redirect to your sign-in page
      }
   });
});

  </script>
<!-- Legacy dark background wrapper retained for reference -->
    <!-- Layout and visual styling for chat workspace -->
    <style>
        /* General styles */
body {
  font-family: 'Inconsolata', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    background-color: #FFFFFF;
    transition: background-color 0.3s, color 0.3s;
}
    body.dark-mode {
      background-color: #212121;
      color: white;
    }
.chat-container {
            width: 100%;
            height: 80vh;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .input-area {
            max-width: 500px;
            width: 100%;
            display: flex;
            padding: 15px;
            justify-content: space-between;
            align-items: center;
        }
        .input-area input {
            background-color: #161616;
            color: white;
            border-radius: 30px;
            padding: 12px 20px;
            border: 1px solid #444;
            width: 90%;
            font-size: 14px;
            outline: none;
        }
        .show {
  display: block;
}
        .input-area button {
          background: linear-gradient(90deg, #3b82f6, #9333ea);
            padding: 12px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .input-area button svg {
            fill: white;
            width: 20px;
            height: 20px;
        }
        .input-area input:focus {
            border-color: #4c4cff;
        }
        #chatbutton {
        background-color: #000;
        color: #fff;
        padding: 15px 32px;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        margin: 10px;
      }
      #chatbutton:hover {
        background-color: #161616;
      }
      #chat {
        text-align: center;
        width: 100%;
        padding: 10px;
        max-height: 400px;
        border-radius: 8px;
        overflow-y: auto;
        position: relative;
      }
      #input {
            outline: none;
      }
      .message {
  max-width: 80%;
  padding: 10px 15px;
  border-radius: 15px;
  margin: 8px 0;
  display: inline-block;
  clear: both;
}


.group {
 position: relative;
}

.input {
 font-size: 16px;
 padding: 10px 10px 10px 5px;
 display: block;
 border: none;
 border-bottom: 1px solid #515151;
 background: transparent;
}

.input:focus {
 outline: none;
}

label {
 color: #999;
 font-size: 18px;
 font-weight: normal;
 position: absolute;
 pointer-events: none;
 left: 5px;
 top: 10px;
 transition: 0.2s ease all;
 -moz-transition: 0.2s ease all;
 -webkit-transition: 0.2s ease all;
}

.input:focus ~ label, .input:valid ~ label {
 top: -20px;
 font-size: 14px;
 color: #5264AE;
}

.bar {
 position: relative;
 display: block;
 /* width: 200px; */
}

.bar:before, .bar:after {
 content: '';
 height: 2px;
 width: 0;
 bottom: 1px;
 position: absolute;
 background: #5264AE;
 transition: 0.2s ease all;
 -moz-transition: 0.2s ease all;
 -webkit-transition: 0.2s ease all;
}

.bar:before {
 left: 50%;
}

.bar:after {
 right: 50%;
}

.input:focus ~ .bar:before, .input:focus ~ .bar:after {
 width: 50%;
}

.highlight {
 position: absolute;
 height: 60%;
 width: 100px;
 top: 25%;
 left: 0;
 pointer-events: none;
 opacity: 0.5;
}

.input:focus ~ .highlight {
 animation: inputHighlighter 0.3s ease;
}

@keyframes inputHighlighter {
 from {
  background: #5264AE;
 }

 to {
  width: 0;
  background: transparent;
 }
}



.message-user {
  /* background-color: #3b82f6;
  color: white; */
  float: right;
  text-align: right;
  border-bottom-right-radius: 0;
  font-size: 20px;
}

.message-ai {
  /* background-color: #444;
  color: white; */
  float: left;
  text-align: left;
  border-bottom-left-radius: 0;
  font-size: 20px;
}


/* Container */
.login-container {
    background: #ffffff;
    padding: 30px;
    border-radius: 10px;
    text-align: center;
    width: 500px; /* Instead of 100% */
    max-width: 90%;
    height: auto; /* Instead of 100% */
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
}


.login-containertwo {
    padding: 20px;
    text-align: center;
    width: 20%;
    height: 100%;
}

.seperator {
    border-radius: 10px;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
    text-align: center;
    width: 10px;
}

.dropdown {
  position: relative;
  display: inline-block;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f1f1f1;
  overflow: auto;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
  border-radius: 10%;
}

.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  border-radius: 10%;
}

.dropdown a:hover {background-color: #ddd;}


.popup {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: rgba(0, 0, 0);
      color: white;
      padding: 10px;
      border-radius: 5px;
      display: none; /* Start hidden */
      opacity: 0;
      transition: opacity 0.5s;
      max-width: 270px;
      z-index: 1000;
    }
    .close-btn {
      width: 100%;
    padding: 12px;
    background: #007bff;
    border: none;
    color: white;
    font-size: 16px;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s;
    }
    .close-btn:hover {
      background: #0056b3;
    }
    .input-group {
    position: relative;
    margin-bottom: 15px;
}
/* Heading */
h2 {
    margin-bottom: 20px;
    font-size: 24px;
    color: #333;
}

/* Input fields */
.input-group {
    position: relative;
    margin-bottom: 15px;
}

.input-group input {
    width: 90%;
    padding: 12px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
    outline: none;
    transition: border-color 0.3s;
}

.input-group input:focus {
    border-color: #007bff;
}

/* Button */
.userbutton {
    width: 100%;
    padding: 10px;
    background: #e0e0e0;
    border: none;
    color: white;
    font-size: 16px;
    border-radius: 50%;
    cursor: pointer;
    transition: background 0.3s;

}



.darkmode {
    padding: 10px;
    background: #e0e0e0;
    border: none;
    color: white;
    font-size: 16px;
    border-radius: 50%;
    cursor: pointer;
    transition: background 0.3s;

}

.menubut {
    padding: 10px;
    background: #e0e0e0;
    border: none;
    color: white;
    font-size: 16px;
    border-radius: 50%;
    cursor: pointer;
    transition: background 0.3s;

}
/* <!-- From Uiverse.io by ZacharyCrespin -->  */
.spinner {
  --size: 30px;
  --color: white;
  width: 100px;
  height: 100px;
  position: relative;
}

.spinner::after,.spinner::before {
  box-sizing: border-box;
  position: absolute;
  content: "";
  width: var(--size);
  height: var(--size);
  top: 50%;
  animation: up 2.4s cubic-bezier(0, 0, 0.24, 1.21) infinite;
  left: 50%;
  background: var(--color);
  box-shadow: 0 0 calc(var(--size) / 3) rgba(0, 0, 0, 0.25);
}

.spinner::after {
  background: var(--color);
  top: calc(50% - var(--size));
  left: calc(50% - var(--size));
  animation: down 2.4s cubic-bezier(0, 0, 0.24, 1.21) infinite;
}

@keyframes down {
  0%, 100% {
    transform: none;
  }

  25% {
    transform: translateX(100%);
  }

  50% {
    transform: translateX(100%) translateY(100%);
  }

  75% {
    transform: translateY(100%);
  }
}

@keyframes up {
  0%, 100% {
    transform: none;
  }

  25% {
    transform: translateX(-100%);
  }

  50% {
    transform: translateX(-100%) translateY(-100%);
  }

  75% {
    transform: translateY(-100%);
  }
}

/* From Uiverse.io by anand_4957 */ 
.book,
.book__pg-shadow,
.book__pg {
  animation: cover 5s ease-in-out infinite;
}
.book {
  background-color: hsl(268, 90%, 65%);
  border-radius: 0.25em;
  box-shadow:
    0 0.25em 0.5em hsla(0, 0%, 0%, 0.3),
    0 0 0 0.25em hsl(278, 100%, 57%) inset;
  padding: 0.25em;
  perspective: 37.5em;
  position: relative;
  width: 8em;
  height: 6em;
  transform: translate3d(0, 0, 0);
  transform-style: preserve-3d;
}
.book__pg-shadow,
.book__pg {
  position: absolute;
  left: 0.25em;
  width: calc(50% - 0.25em);
}
.book__pg-shadow {
  animation-name: shadow;
  background-image: linear-gradient(
    -45deg,
    hsla(0, 0%, 0%, 0) 50%,
    hsla(0, 0%, 0%, 0.3) 50%
  );
  filter: blur(0.25em);
  top: calc(100% - 0.25em);
  height: 3.75em;
  transform: scaleY(0);
  transform-origin: 100% 0%;
}
.book__pg {
  animation-name: pg1;
  background-color: hsl(223, 10%, 100%);
  background-image: linear-gradient(
    90deg,
    hsla(223, 10%, 90%, 0) 87.5%,
    hsl(223, 10%, 90%)
  );
  height: calc(100% - 0.5em);
  transform-origin: 100% 50%;
}
.book__pg--2,
.book__pg--3,
.book__pg--4 {
  background-image: repeating-linear-gradient(
      hsl(223, 10%, 10%) 0 0.125em,
      hsla(223, 10%, 10%, 0) 0.125em 0.5em
    ),
    linear-gradient(90deg, hsla(223, 10%, 90%, 0) 87.5%, hsl(223, 10%, 90%));
  background-repeat: no-repeat;
  background-position: center;
  background-size:
    2.5em 4.125em,
    100% 100%;
}
.book__pg--2 {
  animation-name: pg2;
}
.book__pg--3 {
  animation-name: pg3;
}
.book__pg--4 {
  animation-name: pg4;
}
.book__pg--5 {
  animation-name: pg5;
}

/* Dark theme */
@media (prefers-color-scheme: dark) {
  :root {
    --bg: hsl(223, 10%, 30%);
    --fg: hsl(223, 10%, 90%);
  }
}

/* Animations */
@keyframes cover {
  from,
  5%,
  45%,
  55%,
  95%,
  to {
    animation-timing-function: ease-out;
    background-color: hsl(278, 84%, 67%);
  }
  10%,
  40%,
  60%,
  90% {
    animation-timing-function: ease-in;
    background-color: hsl(271, 90%, 45%);
  }
}
@keyframes shadow {
  from,
  10.01%,
  20.01%,
  30.01%,
  40.01% {
    animation-timing-function: ease-in;
    transform: translate3d(0, 0, 1px) scaleY(0) rotateY(0);
  }
  5%,
  15%,
  25%,
  35%,
  45%,
  55%,
  65%,
  75%,
  85%,
  95% {
    animation-timing-function: ease-out;
    transform: translate3d(0, 0, 1px) scaleY(0.2) rotateY(90deg);
  }
  10%,
  20%,
  30%,
  40%,
  50%,
  to {
    animation-timing-function: ease-out;
    transform: translate3d(0, 0, 1px) scaleY(0) rotateY(180deg);
  }
  50.01%,
  60.01%,
  70.01%,
  80.01%,
  90.01% {
    animation-timing-function: ease-in;
    transform: translate3d(0, 0, 1px) scaleY(0) rotateY(180deg);
  }
  60%,
  70%,
  80%,
  90%,
  to {
    animation-timing-function: ease-out;
    transform: translate3d(0, 0, 1px) scaleY(0) rotateY(0);
  }
}
@keyframes pg1 {
  from,
  to {
    animation-timing-function: ease-in-out;
    background-color: hsl(223, 10%, 100%);
    transform: translate3d(0, 0, 1px) rotateY(0.4deg);
  }
  10%,
  15% {
    animation-timing-function: ease-out;
    background-color: hsl(223, 10%, 100%);
    transform: translate3d(0, 0, 1px) rotateY(180deg);
  }
  20%,
  80% {
    animation-timing-function: ease-in;
    background-color: hsl(223, 10%, 45%);
    transform: translate3d(0, 0, 1px) rotateY(180deg);
  }
  85%,
  90% {
    animation-timing-function: ease-in-out;
    background-color: hsl(223, 10%, 100%);
    transform: translate3d(0, 0, 1px) rotateY(180deg);
  }
}
@keyframes pg2 {
  from,
  to {
    animation-timing-function: ease-in;
    background-color: hsl(223, 10%, 45%);
    transform: translate3d(0, 0, 1px) rotateY(0.3deg);
  }
  5%,
  10% {
    animation-timing-function: ease-in-out;
    background-color: hsl(223, 10%, 100%);
    transform: translate3d(0, 0, 1px) rotateY(0.3deg);
  }
  20%,
  25% {
    animation-timing-function: ease-out;
    background-color: hsl(223, 10%, 100%);
    transform: translate3d(0, 0, 1px) rotateY(179.9deg);
  }
  30%,
  70% {
    animation-timing-function: ease-in;
    background-color: hsl(223, 10%, 45%);
    transform: translate3d(0, 0, 1px) rotateY(179.9deg);
  }
  75%,
  80% {
    animation-timing-function: ease-in-out;
    background-color: hsl(223, 10%, 100%);
    transform: translate3d(0, 0, 1px) rotateY(179.9deg);
  }
  90%,
  95% {
    animation-timing-function: ease-out;
    background-color: hsl(223, 10%, 100%);
    transform: translate3d(0, 0, 1px) rotateY(0.3deg);
  }
}
@keyframes pg3 {
  from,
  10%,
  90%,
  to {
    animation-timing-function: ease-in;
    background-color: hsl(223, 10%, 45%);
    transform: translate3d(0, 0, 1px) rotateY(0.2deg);
  }
  15%,
  20% {
    animation-timing-function: ease-in-out;
    background-color: hsl(223, 10%, 100%);
    transform: translate3d(0, 0, 1px) rotateY(0.2deg);
  }
  30%,
  35% {
    animation-timing-function: ease-out;
    background-color: hsl(223, 10%, 100%);
    transform: translate3d(0, 0, 1px) rotateY(179.8deg);
  }
  40%,
  60% {
    animation-timing-function: ease-in;
    background-color: hsl(223, 10%, 45%);
    transform: translate3d(0, 0, 1px) rotateY(179.8deg);
  }
  65%,
  70% {
    animation-timing-function: ease-in-out;
    background-color: hsl(223, 10%, 100%);
    transform: translate3d(0, 0, 1px) rotateY(179.8deg);
  }
  80%,
  85% {
    animation-timing-function: ease-out;
    background-color: hsl(223, 10%, 100%);
    transform: translate3d(0, 0, 1px) rotateY(0.2deg);
  }
}
@keyframes pg4 {
  from,
  20%,
  80%,
  to {
    animation-timing-function: ease-in;
    background-color: hsl(223, 10%, 45%);
    transform: translate3d(0, 0, 1px) rotateY(0.1deg);
  }
  25%,
  30% {
    animation-timing-function: ease-in-out;
    background-color: hsl(223, 10%, 100%);
    transform: translate3d(0, 0, 1px) rotateY(0.1deg);
  }
  40%,
  45% {
    animation-timing-function: ease-out;
    background-color: hsl(223, 10%, 100%);
    transform: translate3d(0, 0, 1px) rotateY(179.7deg);
  }
  50% {
    animation-timing-function: ease-in;
    background-color: hsl(223, 10%, 45%);
    transform: translate3d(0, 0, 1px) rotateY(179.7deg);
  }
  55%,
  60% {
    animation-timing-function: ease-in-out;
    background-color: hsl(223, 10%, 100%);
    transform: translate3d(0, 0, 1px) rotateY(179.7deg);
  }
  70%,
  75% {
    animation-timing-function: ease-out;
    background-color: hsl(223, 10%, 100%);
    transform: translate3d(0, 0, 1px) rotateY(0.1deg);
  }
}
@keyframes pg5 {
  from,
  30%,
  70%,
  to {
    animation-timing-function: ease-in;
    background-color: hsl(223, 10%, 45%);
    transform: translate3d(0, 0, 1px) rotateY(0);
  }
  35%,
  40% {
    animation-timing-function: ease-in-out;
    background-color: hsl(223, 10%, 100%);
    transform: translate3d(0, 0, 1px) rotateY(0deg);
  }
  50% {
    animation-timing-function: ease-in-out;
    background-color: hsl(223, 10%, 100%);
    transform: translate3d(0, 0, 1px) rotateY(179.6deg);
  }
  60%,
  65% {
    animation-timing-function: ease-out;
    background-color: hsl(223, 10%, 100%);
    transform: translate3d(0, 0, 1px) rotateY(0);
  }
}





.userbutton:hover {
    background: #d6d6d6;
}

.darkmode:hover {
    background: #d6d6d6;
}

.menubut:hover {
    background: #d6d6d6;
}
/* Sign-up link */
.signup-link {
    margin-top: 10px;
    font-size: 14px;
}

.signup-link a {
    color: #007bff;
    text-decoration: none;
}

.signup-link a:hover {
    text-decoration: underline;
}
/* Overlay */
.iframe-popup {
  display: none; /* hidden by default */
  position: fixed;
  inset: 0; /* full screen */
  background: transparent; /* transparency */
  justify-content: center;
  align-items: center;
  z-index: 9999; /* above everything */
}

/* Content box */
.iframe-content {
  position: relative;
  background: white;
  min-width: 30%;
  height: 70%;
  border-radius: 10px;
  box-shadow: 0 0 20px rgba(0,0,0,0.5);
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* Close button */
.iframe-content .close-btn {
  position: absolute;
  top: 8px;
  right: 12px;
  background: none;
  border: none;
  font-size: 18px;
  cursor: pointer;
}

/* From Uiverse.io by mpody11 */ 
.messageBox {
  width: fit-content;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #1e1e1e;
  padding: 0 15px;
  border-radius: 10px;
  border: 1px solid rgb(63, 63, 63);
}
.messageBox:focus-within {
  border: 1px solid #606060;
}
.fileUploadWrapper {
  width: fit-content;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: Arial, Helvetica, sans-serif;
}

#file {
  display: none;
}
.fileUploadWrapper label {
  cursor: pointer;
  width: fit-content;
  height: fit-content;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}
.fileUploadWrapper label svg {
  height: 18px;
}
.fileUploadWrapper label svg path {
  transition: all 0.3s;
}
.fileUploadWrapper label svg circle {
  transition: all 0.3s;
}
.fileUploadWrapper label:hover svg path {
  stroke: #fff;
}
.fileUploadWrapper label:hover svg circle {
  stroke: #fff;
  fill: #3c3c3c;
}
.fileUploadWrapper label:hover .tooltip {
  display: block;
  opacity: 1;
}
.tooltip {
  position: absolute;
  top: -40px;
  display: none;
  opacity: 0;
  color: white;
  font-size: 10px;
  text-wrap: nowrap;
  background-color: #000;
  padding: 6px 10px;
  border: 1px solid #3c3c3c;
  border-radius: 5px;
  box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.596);
  transition: all 0.3s;
}
#messageInput {
  width: 200px;
  height: 100%;
  background-color: transparent;
  outline: none;
  border: none;
  padding-left: 10px;
  color: #f5f5f5;
}
#messageInput:focus ~ #sendButton svg path,
#messageInput:valid ~ #sendButton svg path {
  fill: #3c3c3c;
  stroke: white;
}

#sendButton {
  width: fit-content;
  height: 100%;
  background-color: transparent;
  outline: none;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s;
}
#sendButton svg {
  height: 18px;
  transition: all 0.3s;
}
#sendButton svg path {
  transition: all 0.3s;
}
#sendButton:hover svg path {
  fill: #3682f4;
  stroke: white;
}

/* Iframe itself */
.iframe-content iframe {
  width: 100%;
  height: 100%;
  border: none;
}


/* From Uiverse.io by LilaRest */ 
.card {
  --bg: #e8e8e8;
  --contrast: #e2e0e0;
  --grey: #93a1a1;
  position: relative;
  padding: 9px;
  background-color: var(--bg);
  border-radius: 35px;
  box-shadow: rgba(50, 50, 93, 0.25) 0px 50px 100px -20px, rgba(0, 0, 0, 0.3) 0px 30px 60px -30px, rgba(10, 37, 64, 0.35) 0px -2px 6px 0px inset;
}

.card-overlay {
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: repeating-conic-gradient(var(--bg) 0.0000001%, var(--grey) 0.000104%) 60% 60%/600% 600%;
  filter: opacity(10%) contrast(105%);
}

.card-inner {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  width: 340px;
  min-height: 580px;
  background-color: var(--contrast);
  border-radius: 30px;
  /* Content style */
  font-size: 30px;
  font-weight: 900;
  text-align: center;
  /* font-family: 'Inconsolata', monospace; */
}

/* From Uiverse.io by JaydipPrajapati1910 */ 
.card.dark {
  --bg: #555;
  --contrast: #2c2c2c;
  --grey: #373838;
  position: relative;
  padding: 9px;
  background-color: var(--bg);
  border-radius: 35px;
  border-width: 0px;
  box-shadow: rgba(50, 50, 93, 0.25) 0px 50px 100px -20px, rgba(0, 0, 0, 0.3) 0px 30px 60px -30px, rgba(10, 37, 64, 0.35) 0px -2px 6px 0px inset;
}

.card-overlay.dark {
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: repeating-conic-gradient(var(--bg) 0.0000001%, var(--grey) 0.000104%) 60% 60%/600% 600%;
  filter: opacity(10%) contrast(105%);
}

.card-inner.dark {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
  width: 340px;
  min-height: 580px;
  background-color: var(--contrast);
  border-radius: 30px;
  /* Content style */
  font-size: 30px;
  font-weight: 900;
  text-align: center;
  /* font-family: 'Inconsolata', monospace; */
}

.error-alert {
      position: relative;
      width: 100%;
      max-width: 16rem; /* 256px / 16 = 16rem */
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 1rem; /* py-3 px-4 */
      border-radius: 0.5rem;
      font-size: 1rem;
      font-weight: 500;
      transition: all 0.5s ease;
      border: 1px solid #f85149;
      color: #b22b2b;
      background: linear-gradient(#f851491a, #f851491a);
    }

    .error-alert svg {
      color: #b22b2b;
    }
.container-ia-chat {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: end;
  width: 300px;
}

.container-upload-files {
  position: absolute;
  left: 0;
  display: flex;
  color: #aaaaaa;
  transition: all 0.5s;

  & .upload-file {
    margin: 5px;
    padding: 2px;
    cursor: pointer;
    transition: all 0.5s;

    &:hover {
      color: #4c4c4c;
      scale: 1.1;
    }
  }
}

.input-text {
  max-width: 190px;
  width: 100%;
  margin-left: 72px;
  padding: 0.75rem 1rem;
  padding-right: 46px;
  border-radius: 50px;
  border: none;
  outline: none;
  background-color: #e9e9e9;
  color: #4c4c4c;
  font-size: 14px;
  line-height: 18px;
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  font-weight: 500;
  transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.05);
  z-index: 999;

  &::placeholder {
    color: #959595;
  }

  &:focus-within,
  &:valid {
    max-width: 250px;
    margin-left: 42px;

    & ~ .container-upload-files {
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
      filter: blur(5px);
    }

    & ~ .label-files {
      transform: translateX(0) translateY(-50%) scale(1);
      opacity: 1;
      visibility: visible;
      pointer-events: all;
    }
  }

  &::selection {
    background-color: #4c4c4c;
    color: #e9e9e9;
  }

  &:valid ~ .label-text {
    transform: translateX(0) translateY(-50%) scale(1);
    opacity: 1;
    visibility: visible;
    pointer-events: all;
  }

  &:valid ~ .label-voice {
    transform: translateX(0) translateY(-50%) scale(0.25);
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
  }
}

.input-voice {
  display: none;

  &:checked ~ .container-upload-files {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    filter: blur(5px);
  }

  &:checked ~ .input-text {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    filter: blur(5px);
  }
}

.label-files {
  position: absolute;
  top: 50%;
  left: 0;
  transform: translateX(-20px) translateY(-50%) scale(1);
  display: flex;
  padding: 0.5rem;
  color: #959595;
  background-color: #e9e9e9;
  border-radius: 50px;
  cursor: pointer;
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.05);

  &:focus-visible,
  &:hover {
    color: #4c4c4c;
  }
}

.label-voice,
.label-text {
  position: absolute;
  top: 50%;
  right: 0.25rem;
  transform: translateX(0) translateY(-50%) scale(1);
  width: 36px;
  height: 36px;
  display: flex;
  padding: 6px;
  border: none;
  outline: none;
  cursor: pointer;
  transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.05);
  z-index: 999;
}

.input-voice:checked ~ .label-voice {
  background-color: #e9e9e9;
  right: 0;
  width: 300px;
  height: 300px;
  border-radius: 3rem;
  box-shadow:
    0 10px 40px rgba(0, 0, 60, 0.25),
    inset 0 0 10px rgba(255, 255, 255, 0.5);

  & .icon-voice {
    opacity: 0;
  }

  & .text-voice p {
    opacity: 1;
  }
}

.label-voice {
  color: #959595;
  overflow: hidden;

  &:hover,
  &:focus-visible {
    color: #4c4c4c;
  }

  &:active svg {
    scale: 1.1;
  }

  & .icon-voice {
    position: absolute;
    transition: all 0.3s;
  }

  & .text-voice {
    position: absolute;
    inset: 1.25rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;

    & p {
      opacity: 0;
      transition: all 0.3s;
      text-wrap: nowrap;

      &:first-child {
        font-size: 20px;
        font-weight: 500;
        color: transparent;
        background-image: linear-gradient(
          -40deg,
          #959595 0% 35%,
          #e770cd 40%,
          #ffcef4 50%,
          #e770cd 60%,
          #959595 65% 100%
        );
        background-clip: text;
        background-size: 900px;
        animation: text-light 6s ease infinite;
      }

      &:last-child {
        font-size: 12px;
        color: #2b2b2b;
        mix-blend-mode: difference;
      }
    }
  }
}

@keyframes text-light {
  0% {
    background-position: 0px;
  }

  100% {
    background-position: 900px;
  }
}

.label-text {
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transform: translateY(-50%) scale(0.25);
  color: #e9e9e9;
  background: linear-gradient(to top right, #9147ff, #ff4141);
  box-shadow: inset 0 0 4px rgba(255, 255, 255, 0.5);
  border-radius: 50px;

  &:hover,
  &:focus-visible {
    transform-origin: top center;
    box-shadow: inset 0 0 6px rgba(255, 255, 255, 1);
  }

  &:active {
    scale: 0.9;
  }
}

.ai {
  --z: 0;
  --s: 300px;
  --p: calc(var(--s) / 4);
  width: var(--s);
  aspect-ratio: 1;
  padding: var(--p);
  display: grid;
  place-items: center;
  position: relative;
  animation: circle1 5s ease-in-out infinite;

  &::before,
  &::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 50%;
    height: 50%;
    border-radius: 50%;
    border: 2px solid white;
    box-shadow: 0 0 30px rgba(234, 170, 255, 1);
    filter: blur(5px);
    transform: translate(-50%, -50%);
    animation: wave 1.5s linear infinite;
  }

  &::after {
    animation-delay: 0.4s;
  }
}

@keyframes wave {
  0% {
    transform: translate(-50%, -50%) scale(1);
    opacity: 0;
    box-shadow: 0 0 50px rgba(234, 170, 255, 0.9);
  }
  35% {
    transform: translate(-50%, -50%) scale(1.3);
    opacity: 1;
  }
  70%,
  100% {
    transform: translate(-50%, -50%) scale(1.6);
    opacity: 0;
    box-shadow: 0 0 50px rgba(234, 170, 255, 0.3);
  }
}

@keyframes ai1 {
  0% {
    transform: rotate(0deg) translate(50%) scale(0.9);
    opacity: 0;
  }

  25% {
    transform: rotate(90deg) translate(50%) scale(1.8);
    opacity: 1;
  }

  50% {
    transform: rotate(180deg) translate(50%) scale(0.7);
    opacity: 0.4;
  }

  75% {
    transform: rotate(270deg) translate(50%) scale(1.2);
    opacity: 1;
  }

  100% {
    transform: rotate(360deg) translate(50%) scale(0.9);
    opacity: 0;
  }
}

@keyframes ai2 {
  0% {
    transform: rotate(90deg) translate(50%) scale(0.5);
  }

  25% {
    transform: rotate(180deg) translate(50%) scale(1.7);
    opacity: 0;
  }

  50% {
    transform: rotate(270deg) translate(50%) scale(1);
    opacity: 0;
  }

  75% {
    transform: rotate(360deg) translate(50%) scale(0.8);
    opacity: 0;
  }

  100% {
    transform: rotate(450deg) translate(50%) scale(0.5);
    opacity: 1;
  }
}

@keyframes ai3 {
  0% {
    transform: rotate(180deg) translate(50%) scale(0.8);
    opacity: 0.8;
  }

  25% {
    transform: rotate(270deg) translate(50%) scale(1.5);
  }

  50% {
    transform: rotate(360deg) translate(50%) scale(0.6);
    opacity: 0.4;
  }

  75% {
    transform: rotate(450deg) translate(50%) scale(1.3);
    opacity: 0.7;
  }

  100% {
    transform: rotate(540deg) translate(50%) scale(0.8);
    opacity: 0.8;
  }
}

@keyframes ai4 {
  0% {
    transform: rotate(270deg) translate(50%) scale(1);
    opacity: 1;
  }

  25% {
    transform: rotate(360deg) translate(50%) scale(0.7);
  }

  50% {
    transform: rotate(450deg) translate(50%) scale(1.6);
    opacity: 0.5;
  }

  75% {
    transform: rotate(540deg) translate(50%) scale(0.9);
    opacity: 0.8;
  }

  100% {
    transform: rotate(630deg) translate(50%) scale(1);
    opacity: 1;
  }
}

.c {
  position: absolute;
  width: 300px;
  aspect-ratio: 1;
  border-radius: 50%;
}

.c1 {
  background: radial-gradient(50% 50% at center, #c979ee, #74bcd6);
  width: 200px;
  animation: ai1 5.5s linear infinite;
}

.c2 {
  background: radial-gradient(50% 50% at center, #ef788c, #e7e7fb);
  width: 100px;
  animation: ai2 6s linear infinite;
}

.c3 {
  background: radial-gradient(50% 50% at center, #eb7fc6, transparent);
  width: 150px;
  opacity: 0.6;
  animation: ai3 4.8s linear infinite;
}

.c4 {
  background: #6d67c8;
  animation: ai4 5.2s linear infinite;
}

.container {
  overflow: hidden;
  background: #b6a9f8;
  width: 100%;
  border-radius: 50%;
  aspect-ratio: 1;
  position: relative;
  display: grid;
  place-items: center;
}

.glass {
  overflow: hidden;
  position: absolute;
  inset: calc(var(--p) - 4px);
  border-radius: 50%;
  backdrop-filter: blur(10px);
  box-shadow:
    0 0 50px rgba(255, 255, 255, 0.3),
    0 50px 50px rgba(0, 0, 0, 0.3),
    0 0 25px rgba(255, 255, 255, 1);
  background: radial-gradient(
    75px at 70% 30%,
    rgba(255, 255, 255, 0.7),
    transparent
  );
}

.rings {
  aspect-ratio: 1;
  border-radius: 50%;
  position: absolute;
  inset: 0;
  perspective: 11rem;
  opacity: 0.9;

  &:before,
  &:after {
    content: "";
    position: absolute;
    inset: 0;
    background: rgba(255, 0, 0, 1);
    border-radius: 50%;
    border: 6px solid transparent;
    mask:
      linear-gradient(#fff 0 0) padding-box,
      linear-gradient(#fff 0 0);
    background: linear-gradient(white, blue, magenta, violet, lightyellow)
      border-box;
    mask-composite: exclude;
  }
}

.rings::before {
  animation: ring180 10s ease-in-out infinite;
}

.rings::after {
  animation: ring90 10s ease-in-out infinite;
}

@keyframes ring180 {
  0% {
    transform: rotateY(180deg) rotateX(180deg) rotateZ(180deg);
  }

  25% {
    transform: rotateY(180deg) rotateX(180deg) rotateZ(180deg);
  }

  50% {
    transform: rotateY(360deg) rotateX(360deg) rotateZ(360deg);
  }

  80% {
    transform: rotateY(360deg) rotateX(360deg) rotateZ(360deg);
  }

  100% {
    transform: rotateY(540deg) rotateX(540deg) rotateZ(540deg);
  }
}

@keyframes ring90 {
  0% {
    transform: rotateY(90deg) rotateX(90deg) rotateZ(90deg);
  }

  25% {
    transform: rotateY(90deg) rotateX(90deg) rotateZ(90deg) scale(1.1);
  }

  50% {
    transform: rotateY(270deg) rotateX(270deg) rotateZ(270deg);
  }

  75% {
    transform: rotateY(270deg) rotateX(270deg) rotateZ(270deg);
  }

  100% {
    transform: rotateY(450deg) rotateX(450deg) rotateZ(450deg);
  }
}

@keyframes circle1 {
  0% {
    transform: scale(0.97);
  }

  15% {
    transform: scale(1);
  }

  30% {
    transform: scale(0.98);
  }

  45% {
    transform: scale(1);
  }

  60% {
    transform: scale(0.97);
  }

  85% {
    transform: scale(1);
  }

  100% {
    transform: scale(0.97);
  }
}


    </style>



  <div class="card-overlay"></div>
  <div class="card-inner">
    <div>
      <br>
        <div style="text-align: right;">
        
            <div class="dropdown">
              <button onclick="myFunction()" class="userbutton"><img src="/logos/logo/user.png" height="20px" width="20px"></button>
              <div style="text-align: left;">
              <div id="myDropdown" class="dropdown-content">
                <a href="#" onclick="openIframe('settings.htm')"style="font-size: 20px;">Settings</a>
                <a href="https://syvaai.com/contact.html" style="font-size: 20px;">Report unsafe content</a>
                <a href="https://syvaai.com/donate.html" style="color:rgb(3, 104, 3); font-size: 20px;">Donate</a>
              </div>
            </div>
            </div>
        

          <button onclick="myFunction2()" id="dark-toggle" class="darkmode"><img src="/logos/logo/day-and-night.png" height="20px" width="20px"></button>
          <button onclick="myFunction3()" id="toggleChatsBtn" class="menubut"><img src="/logos/logo/menu.png" height="20px" width="20px"></button>
          <button onclick="startNewChat()" id="toggleChatsBtn" class="menubut"><img src="/logos/logo/newchat.png" height="20px" width="20px"></button>
        </div>
        <br>
        <h3 class="font-roboto-Mono" >Hello! How can I help?</h3>
        <div class="text-align: center">
        <div id="chat"></div>
        </div>
        <br>
<div class="group">
  <!-- From Uiverse.io by mpody11 --> 
<div class="messageBox">
  <div class="fileUploadWrapper">
    <label for="file">
      <svg viewBox="0 0 337 337" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle
          cx="168.5"
          cy="168.5"
          r="158.5"
          fill="none"
          stroke="#6c6c6c"
          stroke-width="20"
        ></circle>
        <path
          d="M167.759 79V259"
          stroke="#6c6c6c"
          stroke-width="25"
          stroke-linecap="round"
        ></path>
        <path
          d="M79 167.138H259"
          stroke="#6c6c6c"
          stroke-width="25"
          stroke-linecap="round"
        ></path>
      </svg>
      <span class="tooltip">Add an image</span>
    </label>
    <input name="file" id="file" type="file" />
  </div>
  <input id="messageInput" type="text" placeholder="Message..." required="" />
  <button id="sendButton">
    <svg viewBox="0 0 664 663" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M646.293 331.888L17.7538 17.6187L155.245 331.888M646.293 331.888L17.753 646.157L155.245 331.888M646.293 331.888L318.735 330.228L155.245 331.888"
        fill="none"
      ></path>
      <path
        d="M646.293 331.888L17.7538 17.6187L155.245 331.888M646.293 331.888L17.753 646.157L155.245 331.888M646.293 331.888L318.735 330.228L155.245 331.888"
        stroke="#6c6c6c"
        stroke-width="33.67"
        stroke-linecap="round"
        stroke-linejoin="round"
      ></path>
    </svg>
  </button>
</div>

</div>

</div>
<div id="iframePopup" class="iframe-popup">
  <div class="iframe-content">
    <iframe id="iframeBox" src="" frameborder="0"></iframe>
  </div>
</div>
<div>
<br>
</div>
  <br>
  <!-- Legacy error banner retained for debugging
  <!-- <div class="error-alert">
    <p class="alert-content">
      <svg
        stroke="currentColor"
        fill="none"
        stroke-width="2"
        viewBox="0 0 24 24"
        stroke-linecap="round"
        stroke-linejoin="round"
        height="28"
        width="28"
        class="icon-lg"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"
        ></path>
        <path d="M12 9v4"></path>
        <path d="M12 17h.01"></path>
      </svg>
    <small><small>Servers are slow right now!<br>
    There is a limited amount of servers to respond to requests, so response time may be slow.</small></small>
    </p>
  </div> -->

<!-- Random greeting rotation for hero tagline -->
<script>
const messages = [
"Hello!",
"Hi there!",
"Greetings!",
"Welcome back!",
"Good to see you!",
"Glad you are here.",
"Hello, welcome!",
"Nice to see you again.",
"wsp",
"Hi, welcome!",
"Hello and welcome!",
"Welcome!",
"Hello, nice to see you.",
"Good to have you back.",
"Hi, good to see you.",
"Hello, glad to see you.",
"six seven",
];


const greeting = document.querySelector("h3.font-roboto-Mono");
let lastIndex = -1; // remember the last message

function setRandomGreeting() {
  let randomIndex;
  do {
    randomIndex = Math.floor(Math.random() * messages.length);
  } while (randomIndex === lastIndex); // make sure it's different
  lastIndex = randomIndex;
  greeting.textContent = messages[randomIndex];
}

// Set one random message on load
setRandomGreeting();
</script>

  <br>
          <!-- Legacy chat input markup retained for reference -->
          <!-- <input type="text" id="input" placeholder="Message..."> -->

        <!-- <div class="group">
    
  <input required="" type="text" class="input">
  <span class="highlight"></span>
  <span class="bar"></span>
  <label>Chat</label>
</div> -->

</div>
  </div>
</div>

























    <!-- <div>
        <div style="text-align: right;">
        
            <div class="dropdown">
              <button onclick="myFunction()" class="userbutton"><img src="/logos/logo/user.png" height="20px" width="20px"></button>
              <div style="text-align: left;">
              <div id="myDropdown" class="dropdown-content">
                <a href="settings.htm">Settings</a>
                <a href="https://syvaai.com/donate.html" style="color:rgb(3, 104, 3);">Donate</a>
              </div>
            </div>
            </div>
        

          <button onclick="myFunction2()" id="dark-toggle" class="darkmode"><img src="/logos/logo/day-and-night.png" height="20px" width="20px"></button>
          <button onclick="myFunction3()" id="toggleChatsBtn" class="menubut"><img src="logos/logo/menu.png" height="20px" width="20px"></button>
        </div>

            
          
        <br>
        <h3 class="font-roboto-Mono" >Hello! How can I help?</h3>
        <div class="text-align: center">
        <div id="chat"></div>
        </div>
        <input type="text" id="input" placeholder="Message...">
        <br>
    </div> -->
  <!-- Sidebar container populated with previous conversations -->
  <div id="chatsText" class="hidden text-left">
  <div class="login-containertwo">
    <small><p style="color:gray;" class="text-left">Chats</p></small>
  </div>
</div>


  <!-- Legacy cookie popup markup retained for reference
  <!-- <div id="popup" class="popup">
        <div style="text-align: center;">
          <small>
            <p>We use cookies to remember your username and password, so you don't have to log in frequently.</p>
            <br>
          <button id="close-btn" class="close-btn">Ok</button>
          </div> -->
<script>
function openIframe(url) {
  document.getElementById("iframeBox").src = url; // matches your iframe ID
  document.getElementById("iframePopup").style.display = "flex"; // matches popup ID
}

// Listen for messages from iframe
window.addEventListener("message", function(event) {
  if (event.data === "close-iframe") {
    document.getElementById("iframePopup").style.display = "none";
  }
});
</script>




<script>
  const toggle = document.getElementById('dark-toggle');
  const body = document.body;
  const DARK_MODE_KEY = 'darkMode';

  // Select card elements
  const card = document.querySelector('.card');
  const cardOverlay = document.querySelector('.card-overlay');
  const cardInner = document.querySelector('.card-inner');

  // Load saved mode
  if (localStorage.getItem(DARK_MODE_KEY) === 'true') {
    enableDarkMode();
  }

  toggle.addEventListener('click', () => {
    if (body.classList.contains('dark-mode')) {
      disableDarkMode();
    } else {
      enableDarkMode();
    }
  });

  function enableDarkMode() {
    body.classList.add('dark-mode');
    card.classList.add('dark');
    cardOverlay.classList.add('dark');
    cardInner.classList.add('dark');
    localStorage.setItem(DARK_MODE_KEY, 'true');
  }

  function disableDarkMode() {
    body.classList.remove('dark-mode');
    card.classList.remove('dark');
    cardOverlay.classList.remove('dark');
    cardInner.classList.remove('dark');
    localStorage.setItem(DARK_MODE_KEY, 'false');
  }
</script>





          <!-- Dropdown menu visibility management -->
          <script>
 // ADD THIS AT THE TOP - Track session ID
let currentSessionId = null;

initializeChat();

function initializeChat() {
  const input = document.getElementById('input');
  input.addEventListener("keyup", (e) => {
    if (e.key === "Enter" && input.value.trim()) {
      sendMessage(input.value.trim());
      input.value = "";
    }
  });
}

async function sendMessage(message) {
  appendMessage("User", message);

  const chat = document.getElementById('chat');

// Create AI message with main loader
const loaderDiv = document.createElement('div');
loaderDiv.classList.add('message', 'message-ai');
loaderDiv.innerHTML = `<div class="spinner"></div>`;
chat.appendChild(loaderDiv);
chat.scrollTop = chat.scrollHeight;

// ⏳ Create the second (slow) spinner — hidden at first
const slowSpinner = document.createElement('div');
slowSpinner.classList.add('slow-spinner');
slowSpinner.innerHTML = `<p><small><small><small>SyväAI is thinking longer for a better answer...</small></small></p>`;
slowSpinner.style.display = "none"; // start hidden
loaderDiv.appendChild(slowSpinner);

  const startTime = Date.now();

  // Start 10s timer for the slow spinner
  const slowTimer = setTimeout(() => {
    slowSpinner.style.display = 'block';
  }, 10000); // 10 seconds

  try {
    const response = await fetch('https://api.syvaai.com/ask', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ 
        question: message, 
        top_k: 2,
        session_id: currentSessionId  // ← ADDED: Send session ID
      })
    });

    clearTimeout(slowTimer); // stop showing slow spinner if done
    slowSpinner.style.display = 'none';

    const data = await response.json();
    
    // ← ADDED: Save the session ID for next message
    if (data.session_id) {
      currentSessionId = data.session_id;
    }
    
    const aiMessage = data.answer ?? data.response ?? `<div class="error-alert">
    <p class="alert-content">
      <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24"
        stroke-linecap="round" stroke-linejoin="round" height="28" width="28"
        class="icon-lg" xmlns="http://www.w3.org/2000/svg">
        <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
        <path d="M12 9v4"></path>
        <path d="M12 17h.01"></path>
      </svg>
      <small><small>API Error<hr>
      A error occured. (Error code 76)<hr>
      <a href="https://syvaai.zohodesk.com/portal/en/kb/articles/error-76"><u>Click here</u></a>
      for a explanation for this error.</small></small>
    </p></div>`;

    // Ensure loader shows at least 1 second
    const elapsed = Date.now() - startTime;
    const delay = Math.max(0, 1000 - elapsed);

    setTimeout(() => {
      loaderDiv.innerHTML = aiMessage;
      chat.scrollTop = chat.scrollHeight;

            // ADD THIS BLOCK HERE ⬇️⬇️⬇️
      saveMessageToFirebase(message, aiMessage);


    }, delay);

  } catch (error) {
    console.error("API Error:", error);

    clearTimeout(slowTimer);
    slowSpinner.style.display = 'none';

    const elapsed = Date.now() - startTime;
    const delay = Math.max(0, 1000 - elapsed);

    setTimeout(() => {
      loaderDiv.innerHTML = `<div class="error-alert">
      <p class="alert-content">
        <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24"
          stroke-linecap="round" stroke-linejoin="round" height="28" width="28"
          class="icon-lg" xmlns="http://www.w3.org/2000/svg">
          <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
          <path d="M12 9v4"></path>
          <path d="M12 17h.01"></path>
        </svg>
        <small><small>API Error<hr>
        A error occured. (Error code 67)<hr>
        <a href="https://syvaai.zohodesk.com/portal/en/kb/articles/error-67"><u>Click here</u></a>
        for a explanation for this error.</small></small>
      </p></div>`;
      chat.scrollTop = chat.scrollHeight;
    }, delay);
  }
}

function appendMessage(sender, message) {
  const messageDiv = document.createElement('div');
  messageDiv.classList.add('message');
  messageDiv.classList.add(sender === 'User' ? 'message-user' : 'message-ai');
  messageDiv.innerHTML = `${message}`;
  const chat = document.getElementById('chat');
  chat.appendChild(messageDiv);
  chat.scrollTop = chat.scrollHeight;
}

function changeContent2() {
  alert("Coming soon!");
}

function openNav() {
  document.getElementById("mySidenav").style.width = "100%";
}

function closeNav() {
  document.getElementById("mySidenav").style.width = "0";
}

async function startNewChat() {
  // Create a brand new chat
  const chatId = 'chat_' + Date.now();
  chatSessions[chatId] = {
    id: chatId,
    title: 'New Chat',
    messages: [],
    sessionId: null,
    created: Date.now(),
    lastUpdated: Date.now()
  };
  
  activeChatId = chatId;
  currentSessionId = null;
  document.getElementById('chat').innerHTML = '';
  
  // Save to Firebase
  const user = firebase.auth().currentUser;
  if (user && db) {
    await db.collection('users').doc(user.uid).collection('chats').doc(chatId).set(chatSessions[chatId]);
  }
  
  renderChatList();
  console.log("Started new conversation:", chatId);
}

          </script>
          <!-- Popup reminder visibility persistence -->
          <script>
  // Grab the text input
  const inputText = document.getElementById('input-text');

  // Make it respond to Enter key
  inputText.addEventListener('keyup', (e) => {
    if (e.key === 'Enter' && inputText.value.trim()) {
      sendMessage(inputText.value.trim());
      inputText.value = ""; // clear input after sending
    }
  });

  // Reuse your existing sendMessage() and appendMessage() functions
</script>

          <script>
            // Select the button and the "Chats" section
            const toggleChatsBtn = document.getElementById("toggleChatsBtn");
            const chatsText = document.getElementById("chatsText");
          
            // Event listener to toggle the visibility of the "Chats" section
            toggleChatsBtn.addEventListener("click", function() {
              chatsText.classList.toggle("hidden");
            });
          </script>
          
          <script>
            function myFunction() {
              var dropdown = document.getElementById("myDropdown");
              if (dropdown.style.display === "block") {
                dropdown.style.display = "none";
              } else {
                dropdown.style.display = "block";
              }
            }
            
            // Close the dropdown if the user clicks outside of it
            window.onclick = function(event) {
              if (!event.target.closest('.dropdown')) {
                var dropdown = document.getElementById("myDropdown");
                dropdown.style.display = "none";
              }
            }
            </script>
            
          <script>
  window.onload = function () {
    // Check if the user already closed the popup
    const hasClosedPopup = localStorage.getItem('popupClosed');
    const popup = document.getElementById('popup');

    // Only show the popup if it hasn't been closed before
    if (!hasClosedPopup) {
      setTimeout(function () {
        popup.style.display = 'block'; // Make it block so it occupies space
        setTimeout(function () {
          popup.style.opacity = '1'; // Fade in
        }, 10); // Slight delay to trigger CSS transition
      }, 1000);
    }

    // Attach close event to the button
    const closeBtn = document.getElementById('close-btn');
    closeBtn.onclick = function () {
      popup.style.opacity = '0'; // Fade out
      setTimeout(function () {
        popup.style.display = 'none';
        localStorage.setItem('popupClosed', 'true'); // Remember user closed popup
      }, 500);
    };
  };

  async function deleteChat(chatId, event) {
  event.stopPropagation();
  
  if (!confirm('Delete this chat?')) return;
  
  const user = firebase.auth().currentUser;
  
  // Delete from Firebase
  if (user && db) {
    try {
      await db.collection('users').doc(user.uid).collection('chats').doc(chatId).delete();
      console.log('Deleted from Firebase:', chatId);
    } catch (e) {
      console.error('Error deleting:', e);
    }
  }
  
  // Delete locally
  delete chatSessions[chatId];
  
  // If we deleted the active chat, start a new one
  if (activeChatId === chatId) {
    await startNewChat();
  } else {
    renderChatList();
  }
}
  </script>
  <!-- Persistent chat history synchronization -->
  <script>
// Firebase chat list only
let chatSessions = {};
let activeChatId = null;
let db;

setTimeout(() => {
  if (firebase && firebase.firestore) {
    db = firebase.firestore();
    firebase.auth().onAuthStateChanged((user) => {
      if (user) {
        loadChatsFromFirebase(user.uid);
      }
    });
  }
}, 1000);

async function loadChatsFromFirebase(userId) {
  if (!db) return;
  try {
    const snapshot = await db.collection('users').doc(userId).collection('chats').orderBy('lastUpdated', 'desc').get();
    chatSessions = {};
    snapshot.forEach(doc => chatSessions[doc.id] = doc.data());
    renderChatList();
  } catch (e) {
    console.error('Error loading chats:', e);
  }
}

function renderChatList() {
  const container = document.getElementById('chatsText');
  if (!container) return;
  
  const chatIds = Object.keys(chatSessions);
  if (chatIds.length === 0) {
    container.innerHTML = '<div class="login-containertwo"><small><p style="color:gray;">No chats yet</p></small></div>';
    return;
  }
  
  let html = '<div class="login-containertwo"><small><p style="color:gray;">Chats</p></small></div>';
  
  chatIds.forEach(chatId => {
    const chat = chatSessions[chatId];
    const title = chat.title || 'New Chat';
    const isActive = chatId === activeChatId;
    
    html += `
      <div style="
        padding: 10px;
        margin: 8px;
        background: ${isActive ? 'rgba(100,100,255,0.2)' : 'rgba(255,255,255,0.1)'};
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      ">
        <div onclick="loadChatFromList('${chatId}')" style="flex: 1; cursor: pointer;">
          <small>${title}</small>
        </div>
        <button onclick="deleteChat('${chatId}', event)" style="
          background: none;
          border: none;
          color: #ff4444;
          cursor: pointer;
          padding: 4px 8px;
          font-size: 18px;
        ">×</button>
      </div>
    `;
  });
  
  container.innerHTML = html;
}

function loadChatFromList(chatId) {
  const chat = chatSessions[chatId];
  if (!chat) return;
  
  // Clear current chat
  document.getElementById('chat').innerHTML = '';
  
  // Load messages
  chat.messages.forEach(msg => {
    const messageDiv = document.createElement('div');
    messageDiv.classList.add('message');
    messageDiv.classList.add(msg.sender === 'User' ? 'message-user' : 'message-ai');
    messageDiv.innerHTML = msg.content;
    document.getElementById('chat').appendChild(messageDiv);
  });
  
  // Set as active
  activeChatId = chatId;
  currentSessionId = chat.sessionId;
  
  // Close sidebar
  document.getElementById('chatsText').classList.add('hidden');
}

async function saveMessageToFirebase(userMsg, aiMsg) {
  const user = firebase.auth().currentUser;
  if (!user || !db) return;
  
  // Create new chat if none active
  if (!activeChatId) {
    activeChatId = 'chat_' + Date.now();
    chatSessions[activeChatId] = {
      id: activeChatId,
      title: userMsg.substring(0, 30),
      messages: [],
      sessionId: currentSessionId,
      created: Date.now(),
      lastUpdated: Date.now()
    };
  }
  
  // Add messages
  chatSessions[activeChatId].messages.push(
    {sender: 'User', content: userMsg, timestamp: Date.now()},
    {sender: 'AI', content: aiMsg, timestamp: Date.now()}
  );
  chatSessions[activeChatId].lastUpdated = Date.now();
  chatSessions[activeChatId].sessionId = currentSessionId;
  
  // Save to Firebase
  try {
    await db.collection('users').doc(user.uid).collection('chats').doc(activeChatId).set(chatSessions[activeChatId]);
    renderChatList(); // Update sidebar
  } catch (e) {
    console.error('Error saving:', e);
  }
}
</script>
<!-- Icon attribution references -->
<!-- User icon credit: Saepul Nahwan
 Light/Dark icon credit: Freepik-->
</body>
</html>